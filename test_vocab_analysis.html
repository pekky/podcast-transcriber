<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>词汇分析功能测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/style.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container-fluid mt-3">
        <div class="row">
            <!-- 左侧：转录结果模拟 -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5>转录结果（测试）</h5>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-primary" onclick="loadTranscript1()">测试转录1</button>
                            <button class="btn btn-sm btn-outline-primary" onclick="loadTranscript2()">测试转录2</button>
                            <button class="btn btn-sm btn-outline-primary" onclick="loadTranscript3()">AI对话转录</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="transcriptText" class="transcript-text" style="height: 400px; overflow-y: auto; padding: 15px; background: #f8f9fa;">
                            点击上面的按钮加载不同的转录内容...
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 右侧：英语学习面板 -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">英语学习</h6>
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <span id="englishLevelText">中高级 (IELTS 6.0)</span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><h6 class="dropdown-header">英语水平</h6></li>
                                <li><a class="dropdown-item" href="#" data-level="4.0">初级 (IELTS 4.0)</a></li>
                                <li><a class="dropdown-item" href="#" data-level="5.0">中级 (IELTS 5.0)</a></li>
                                <li><a class="dropdown-item active" href="#" data-level="6.0">中高级 (IELTS 6.0)</a></li>
                                <li><a class="dropdown-item" href="#" data-level="7.0">高级 (IELTS 7.0)</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="card-body p-3">
                        <!-- 空状态 -->
                        <div id="vocabEmptyState" class="text-center text-muted py-4">
                            <i class="fas fa-book fa-2x mb-3 opacity-50"></i>
                            <h6>词汇分析</h6>
                            <p class="small">点击加载转录内容，这里将显示超出您英语水平的单词和句子</p>
                        </div>
                        
                        <!-- 学习内容 -->
                        <div id="vocabContent" class="d-none">
                            <!-- 生词列表 -->
                            <div class="mb-4">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="text-primary mb-0">
                                        <i class="fas fa-spell-check me-1"></i>生词 (<span id="vocabCount">0</span>)
                                    </h6>
                                </div>
                                <div id="vocabList" class="vocab-list">
                                    <!-- 动态生成生词 -->
                                </div>
                            </div>
                            
                            <!-- 复杂句子 -->
                            <div class="mb-3">
                                <h6 class="text-success mb-3">
                                    <i class="fas fa-comments me-1"></i>复杂句子 (<span id="sentenceCount">0</span>)
                                </h6>
                                <div id="sentenceList" class="sentence-list">
                                    <!-- 动态生成复杂句子 -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- 分析进度 -->
                        <div id="vocabProgress" class="d-none mb-3">
                            <div class="d-flex align-items-center">
                                <div class="spinner-border spinner-border-sm text-primary me-2" role="status"></div>
                                <span class="small">正在分析词汇难度...</span>
                            </div>
                            <div class="progress mt-2" style="height: 4px;">
                                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="static/js/main.js"></script>
    <script>
        // 测试转录内容
        const testTranscripts = {
            1: `Speaker A: I get very angry when people call me a dumber.

Speaker A: When someone's like, this guy's a dumber, he wants to slow things down.

Speaker A: You heard what I just said.

Speaker A: Like, my father died because of cures that could have happened a few years later.

Speaker A: I understand the benefit of this technology.

Speaker A: I'm sure you've heard the criticism from people like Jensen who say, well, Dario thinks he's the only one who can build this safely and therefore wants to control the entire industry.

Speaker A: I've never said anything like that.

Speaker A: That's an outrageous lie.

Speaker A: That's the most outrageous lie I've ever heard.

Speaker A: Anthropic CEO, Dario Amode joins us to talk about the path forward for artificial intelligence.

Speaker A: Whether gendered AI is a good business and to fire back at those who call him a dumber.`,

            2: `Speaker B: The sustainable development of artificial intelligence requires comprehensive understanding of its implications.

Speaker B: We must consider the phenomenon of technological advancement while maintaining sophisticated safety protocols.

Speaker B: Innovation in this field demands unprecedented collaboration between researchers, policymakers, and industry leaders.

Speaker B: Furthermore, we need to address the ethical considerations that arise from autonomous systems making decisions.

Speaker B: Nevertheless, the potential benefits are enormous if we proceed carefully and thoughtfully.

Speaker B: Therefore, we should establish robust frameworks that ensure responsible development and deployment.`,

            3: `Speaker C: The integration of machine learning algorithms into healthcare systems presents both opportunities and challenges.

Speaker C: Although these technologies can significantly improve diagnostic accuracy, we must carefully consider the privacy implications.

Speaker C: Consequently, healthcare providers need to implement comprehensive data protection measures.

Speaker C: Moreover, the training of medical professionals becomes increasingly important as they adapt to AI-assisted workflows.

Speaker C: Despite initial resistance from some practitioners, early adoption studies show promising results.

Speaker C: However, we cannot ignore the potential for algorithmic bias in medical decision-making processes.

Speaker C: Whether these systems will ultimately enhance or complicate patient care remains to be seen.`
        };
        
        let vocabAnalyzer;
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 创建一个简化版的词汇分析器
            vocabAnalyzer = {
                englishLevel: '6.0',
                vocabEmptyState: document.getElementById('vocabEmptyState'),
                vocabContent: document.getElementById('vocabContent'),
                vocabProgress: document.getElementById('vocabProgress'),
                vocabList: document.getElementById('vocabList'),
                sentenceList: document.getElementById('sentenceList'),
                vocabCount: document.getElementById('vocabCount'),
                sentenceCount: document.getElementById('sentenceCount'),
                
                // 复制主程序的方法
                setCookie: function(name, value, days = 365) {
                    const expires = new Date(Date.now() + days * 864e5).toUTCString();
                    document.cookie = \`\${name}=\${encodeURIComponent(value)}; expires=\${expires}; path=/\`;
                },
                
                getCookie: function(name) {
                    return document.cookie.split('; ').reduce((r, v) => {
                        const parts = v.split('=');
                        return parts[0] === name ? decodeURIComponent(parts[1]) : r;
                    }, '');
                },
                
                // 包含完整的词汇分析逻辑...
                generateMockVocabulary: function(text) {
                    // 这里包含之前实现的完整逻辑
                    const words = text.toLowerCase().match(/\\b[a-z]+\\b/g) || [];
                    const uniqueWords = [...new Set(words)].filter(word => word.length > 3);
                    
                    const advancedVocabDatabase = {
                        'phenomenon': { phonetic: '/fɪˈnɒmɪnən/', definition: '现象；奇迹', level: 'high' },
                        'sophisticated': { phonetic: '/səˈfɪstɪkeɪtɪd/', definition: '精密的；老练的', level: 'advanced' },
                        'comprehensive': { phonetic: '/ˌkɒmprɪˈhensɪv/', definition: '综合的；全面的', level: 'medium' },
                        'artificial': { phonetic: '/ˌɑːtɪˈfɪʃl/', definition: '人工的；人造的', level: 'medium' },
                        'intelligence': { phonetic: '/ɪnˈtelɪdʒəns/', definition: '智力；智能', level: 'medium' },
                        'technology': { phonetic: '/tekˈnɒlədʒi/', definition: '技术；科技', level: 'medium' },
                        'outrageous': { phonetic: '/aʊtˈreɪdʒəs/', definition: '愤慨的；令人震惊的', level: 'advanced' },
                        'anthropic': { phonetic: '/ænˈθrɒpɪk/', definition: '人类的；人为的', level: 'high' },
                        'sustainable': { phonetic: '/səˈsteɪnəbl/', definition: '可持续的', level: 'advanced' },
                        'unprecedented': { phonetic: '/ʌnˈpresɪdentɪd/', definition: '史无前例的', level: 'high' },
                        'algorithms': { phonetic: '/ˈælɡərɪðmz/', definition: '算法', level: 'advanced' },
                        'diagnostic': { phonetic: '/ˌdaɪəɡˈnɒstɪk/', definition: '诊断的', level: 'advanced' },
                        'algorithmic': { phonetic: '/ˌælɡəˈrɪðmɪk/', definition: '算法的', level: 'high' }
                    };
                    
                    const commonWords = new Set([
                        'the', 'and', 'for', 'are', 'but', 'not', 'you', 'all', 'can', 'had', 'her', 'was', 'one', 'our', 'out', 'day', 'get', 'has', 'him', 'his', 'how', 'man', 'new', 'now', 'old', 'see', 'two', 'way', 'who', 'boy', 'did', 'its', 'let', 'put', 'say', 'she', 'too', 'use', 'have', 'this', 'will', 'your', 'from', 'they', 'know', 'want', 'been', 'good', 'much', 'some', 'time', 'very', 'when', 'come', 'here', 'just', 'like', 'long', 'make', 'many', 'over', 'such', 'take', 'than', 'them', 'well', 'were', 'what', 'year'
                    ]);
                    
                    const foundAdvancedWords = [];
                    uniqueWords.forEach(word => {
                        if (advancedVocabDatabase[word]) {
                            foundAdvancedWords.push({
                                word: word,
                                ...advancedVocabDatabase[word]
                            });
                        } else if (!commonWords.has(word) && word.length > 6) {
                            foundAdvancedWords.push({
                                word: word,
                                phonetic: \`/ˈ\${word}/\`,
                                definition: \`\${word}的中文释义\`,
                                level: word.length > 10 ? 'high' : word.length > 8 ? 'advanced' : 'medium'
                            });
                        }
                    });
                    
                    const levelFilter = {
                        '4.0': ['high', 'advanced', 'medium'],
                        '5.0': ['high', 'advanced', 'medium'],
                        '6.0': ['high', 'advanced'],
                        '7.0': ['high']
                    };
                    
                    const allowedLevels = levelFilter[this.englishLevel] || ['high', 'advanced'];
                    const filteredWords = foundAdvancedWords.filter(word => allowedLevels.includes(word.level));
                    
                    return filteredWords.slice(0, Math.min(8, filteredWords.length));
                },
                
                generateMockSentences: function(text) {
                    const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 30);
                    
                    const complexityIndicators = {
                        high: ['therefore', 'however', 'nevertheless', 'consequently', 'furthermore', 'moreover'],
                        advanced: ['although', 'because', 'since', 'unless', 'whether', 'while', 'despite'],
                        medium: ['when', 'where', 'which', 'that', 'who', 'what', 'how', 'why', 'if', 'as']
                    };
                    
                    const complexSentences = [];
                    sentences.forEach(sentence => {
                        const cleanSentence = sentence.trim();
                        const words = cleanSentence.toLowerCase().split(/\\s+/);
                        let complexityLevel = 'Simple';
                        let complexityReason = '';
                        
                        for (const [level, indicators] of Object.entries(complexityIndicators)) {
                            if (indicators.some(indicator => words.includes(indicator))) {
                                if (level === 'high') {
                                    complexityLevel = 'Highly Complex';
                                    complexityReason = '包含高级连接词';
                                    break;
                                } else if (level === 'advanced') {
                                    complexityLevel = 'Advanced';
                                    complexityReason = '包含从属连词';
                                    break;
                                } else if (level === 'medium') {
                                    complexityLevel = 'Complex Structure';
                                    complexityReason = '包含复合结构';
                                }
                            }
                        }
                        
                        if (words.length > 25) {
                            complexityLevel = 'Highly Complex';
                            complexityReason = '长句含多个从句';
                        } else if (words.length > 20) {
                            if (complexityLevel === 'Simple') {
                                complexityLevel = 'Complex Structure';
                                complexityReason = '较长且含从句';
                            }
                        }
                        
                        if (complexityLevel !== 'Simple') {
                            complexSentences.push({
                                text: cleanSentence,
                                complexity: complexityLevel,
                                reason: complexityReason
                            });
                        }
                    });
                    
                    const levelFilter = {
                        '4.0': ['Highly Complex', 'Advanced', 'Complex Structure'],
                        '5.0': ['Highly Complex', 'Advanced', 'Complex Structure'],
                        '6.0': ['Highly Complex', 'Advanced'],
                        '7.0': ['Highly Complex']
                    };
                    
                    const allowedLevels = levelFilter[this.englishLevel] || ['Highly Complex', 'Advanced'];
                    const filteredSentences = complexSentences.filter(sentence => 
                        allowedLevels.includes(sentence.complexity)
                    );
                    
                    return filteredSentences.slice(0, Math.min(5, filteredSentences.length));
                },
                
                analyzeVocabulary: async function(text) {
                    this.vocabEmptyState.classList.add('d-none');
                    this.vocabContent.classList.add('d-none');
                    this.vocabProgress.classList.remove('d-none');
                    
                    // 模拟进度
                    const progressBar = this.vocabProgress.querySelector('.progress-bar');
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 20;
                        progressBar.style.width = \`\${Math.min(progress, 90)}%\`;
                    }, 200);
                    
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    clearInterval(interval);
                    progressBar.style.width = '100%';
                    
                    const vocabData = this.generateMockVocabulary(text);
                    const sentenceData = this.generateMockSentences(text);
                    
                    setTimeout(() => {
                        this.displayVocabularyResults(vocabData, sentenceData);
                    }, 300);
                },
                
                displayVocabularyResults: function(vocabData, sentenceData) {
                    this.vocabProgress.classList.add('d-none');
                    this.vocabContent.classList.remove('d-none');
                    
                    this.vocabCount.textContent = vocabData.length;
                    this.sentenceCount.textContent = sentenceData.length;
                    
                    this.vocabList.innerHTML = vocabData.map(item => \`
                        <div class="vocab-item">
                            <div class="vocab-word">\${item.word}</div>
                            <div class="vocab-phonetic">
                                <span>\${item.phonetic}</span>
                            </div>
                            <div class="vocab-definition">\${item.definition}</div>
                            <span class="vocab-level \${item.level}">\${this.getLevelText(item.level)}</span>
                        </div>
                    \`).join('');
                    
                    this.sentenceList.innerHTML = sentenceData.map(item => \`
                        <div class="sentence-item">
                            <div class="sentence-text">\${item.text}</div>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <span class="sentence-complexity">\${item.complexity}</span>
                                \${item.reason ? \`<small class="text-muted">\${item.reason}</small>\` : ''}
                            </div>
                        </div>
                    \`).join('');
                },
                
                getLevelText: function(level) {
                    const levelMap = {
                        'high': '高难度',
                        'medium': '中等',
                        'advanced': '高级'
                    };
                    return levelMap[level] || '中等';
                },
                
                setEnglishLevel: function(level) {
                    this.englishLevel = level;
                    this.setCookie('englishLevel', level);
                    
                    const levelTexts = {
                        '4.0': '初级 (IELTS 4.0)',
                        '5.0': '中级 (IELTS 5.0)',
                        '6.0': '中高级 (IELTS 6.0)',
                        '7.0': '高级 (IELTS 7.0)'
                    };
                    document.getElementById('englishLevelText').textContent = levelTexts[level] || level;
                    
                    document.querySelectorAll('[data-level]').forEach(item => {
                        item.classList.toggle('active', item.dataset.level === level);
                    });
                    
                    // 如果有内容，重新分析
                    const currentText = document.getElementById('transcriptText').textContent;
                    if (currentText && currentText !== '点击上面的按钮加载不同的转录内容...') {
                        this.analyzeVocabulary(currentText);
                    }
                }
            };
            
            // 绑定英语水平选择事件
            document.querySelectorAll('[data-level]').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    vocabAnalyzer.setEnglishLevel(e.target.dataset.level);
                });
            });
        });
        
        // 加载测试转录的函数
        function loadTranscript1() {
            const text = testTranscripts[1];
            document.getElementById('transcriptText').innerHTML = text.replace(/\n\n/g, '<br><br>');
            vocabAnalyzer.analyzeVocabulary(text);
        }
        
        function loadTranscript2() {
            const text = testTranscripts[2];
            document.getElementById('transcriptText').innerHTML = text.replace(/\n\n/g, '<br><br>');
            vocabAnalyzer.analyzeVocabulary(text);
        }
        
        function loadTranscript3() {
            const text = testTranscripts[3];
            document.getElementById('transcriptText').innerHTML = text.replace(/\n\n/g, '<br><br>');
            vocabAnalyzer.analyzeVocabulary(text);
        }
    </script>
</body>
</html>